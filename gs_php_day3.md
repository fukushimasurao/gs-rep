# ğŸ˜š gs\_php\_day3

### æˆæ¥­è³‡æ–™ <a href="#shou-ye-zi-liao" id="shou-ye-zi-liao"></a>

[https://gitlab.com/gs\_hayato/gs-php-01/-/blob/master/php03\_haifu.zip](https://gitlab.com/gs\_hayato/gs-php-01/-/blob/master/php03\_haifu.zip)

## å‰å›ã®ãŠã•ã‚‰ã„

- DBã‚’åˆ©ç”¨ã—ãŸ
- `PhpMyAdmin`ã‚’åˆ©ç”¨ã—ã¦DBã‚’æ“ä½œã—ãŸã€‚
- `SQL`ã®`INSERT`ã‚’æ›¸ã„ãŸ
- `SQL`ã®`SELECT`ã‚’æ›¸ã„ãŸ
- PHPã®ãƒ•ãƒ­ãƒ³ãƒˆç”»é¢ã‹ã‚‰ã€ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½¿ã£ã¦DBã«ç™»éŒ²ã—ãŸã€‚

## MAMPã®èµ·å‹•ã€DBæº–å‚™

1. MAMPã‚’èµ·å‹•
2. WebStartãƒœã‚¿ãƒ³ã‹ã‚‰èµ·å‹•ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã‚’è¡¨ç¤º
3. ãƒšãƒ¼ã‚¸ã®çœŸã‚“ä¸­MySQLã®ã‚¿ãƒ–ã‹ã‚‰phpMyAdminã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯
4. èµ·å‹•ã—ãŸç”»é¢ãŒMySQLã‚’ç®¡ç†ã™ã‚‹phpMyAdminã®ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
5. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯
6. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆã‹ã‚‰ä»¥ä¸‹ã®åå‰ã§ä½œæˆ

```text
ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åï¼šgs_db3
ç…§åˆé †åºï¼šutf8_unicode_ci
```

7. ä½œæˆãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
å·¦å´ã«`gs_db3`ã¨ã„ã†ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒã§ãã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚
ç¾åœ¨ã¯ç©ºã£ã½ã§ã™ã€‚


## SQLãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
ã€‡ã€‡.sqlã¨ã„ã†SQLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¾ã™ã€‚

1. å¿µã®ç‚ºã€å·¦å´ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰`gs_db3`ã‚’ã‚¯ãƒªãƒƒã‚¯
2. gs_db3ã‚’é¸æŠã—ãŸçŠ¶æ…‹ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦é…å¸ƒã—ãŸè³‡æ–™å†…ã®SQLãƒ•ã‚©ãƒ«ãƒ€å†…ã®php3_sql.sqlã‚’é¸æŠ
4. å®Ÿè¡Œã—ã¦ã¿ã‚‹
5. æˆæ¥­ç”¨ã®DBã¨ä¸­èº«ã‚’ç¢ºèª


## é–¢æ•°åŒ–&å‘¼ã³å‡ºã—
ã‚ˆãä½¿ã†å‡¦ç†ã¯é–¢æ•°åŒ–ã™ã‚‹ã®ãŒä¸€èˆ¬çš„ã§ã™ã€‚
åŒã˜å‡¦ç†ã‚’è¤‡æ•°å›æ›¸ãã®ã§ã¯ãªãé–¢æ•°åŒ–ã—ã¦å†åˆ©ç”¨ã—ã¾ã—ã‚‡ã†ã€‚

1. funcs.phpã«DBæ¥ç¶šé–¢æ•°ã‚’ä½œæˆã™ã‚‹

```php
function db_conn()
{
    try {
        $db_name = "gs_db3";
        $db_id   = "root";
        $db_pw   = "root";
        $db_host = "localhost";
        $pdo = new PDO('mysql:dbname=' . $db_name . ';charset=utf8;host=' . $db_host, $db_id, $db_pw);
        return $pdo;
    } catch (PDOException $e) {
        exit('DB Connection Error:' . $e->getMessage());
    }
}
```

2. åˆ©ç”¨ç®‡æ‰€ã§ã€é–¢æ•°ã‚’å‘¼ã³å‡ºã™ã€‚

```php
// é–¢æ•°ã‚’ä½¿ã„ãŸã„ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸€ç•ªä¸Šã«ä»¥ä¸‹è¨˜å…¥
<?php
require_once('funcs.php');
$pdo = db_conn();
```

## SQLã‚¨ãƒ©ãƒ¼å‡¦ç†ã¨ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå‡¦ç†ã‚’é–¢æ•°åŒ–

1. `funcs.php`ã«SQLã‚¨ãƒ©ãƒ¼é–¢æ•°ã¨ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå‡¦ç†ã‚’ä½œæˆã™ã‚‹

```php
//SQLã‚¨ãƒ©ãƒ¼é–¢æ•°ï¼šsql_error($stmt)
function sql_error($stmt)
{
    $error = $stmt->errorInfo();
    exit('SQLError:' . print_r($error, true));
}

//ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆé–¢æ•°: redirect($file_name)
function redirect($file_name)
{
    header('Location: ' . $file_name );
    exit();
}
```

2. åˆ©ç”¨ç®‡æ‰€ã§ã€é–¢æ•°ã‚’å‘¼ã³å‡ºã™ã€‚

```php
if ($status === false) {
    sql_error($stmt);
} else {
    redirect('index.php');
}
```
