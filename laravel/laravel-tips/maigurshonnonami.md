# マイグレーションの基本的な仕組み

### Laravel におけるマイグレーションが実行されるときの流れ

1. マイグレーションファイルの作成
   * `php artisan make:migration` コマンドを使用して新しいマイグレーションファイルを作成する。このファイルにはデータベーステーブルの作成、変更、削除などの操作を定義するものである。
2. マイグレーションファイルの編集
   * 生成されたマイグレーションファイルを編集して実行するデータベースの操作（テーブルの作成やカラムの追加など）を定義
   * `up` メソッドには，データベースに対して実行する操作を記述し、`down` メソッドには，`up` メソッドで実行した操作を元に戻す操作を記述する（テーブル作成に対するテーブル削除など）．
   * 特にカラム操作のマイグレーションファイルを作成する場合には`down` メソッドを適切に記述することが重要となる．
3. マイグレーションの実行
   * `php artisan migrate` コマンドを実行しマイグレーションファイル内の操作をデータベースに適用する。このコマンドは**まだ実行されていない全てのマイグレーションを順に**実行する。
   * 具体的にはマイグレーションファイルの `up` メソッドが実行される。
4. マイグレーションの記録
   * マイグレーションが実行されると実行された内容が DB の `migrations` テーブルに記録される。これによりどのマイグレーションが既に実行されたかを Laravel が追跡できる
   * `migrations` テーブルのレコードを削除した場合には実行した記録が消去されるため，`php artisan migrate` コマンドを実行するとそのマイグレーションが再度実行される．
5. マイグレーションのロールバック
   * もし最新のマイグレーションを元に戻す必要がある場合，`php artisan migrate:rollback` コマンドを使用して最後に実行されたマイグレーションをロールバック（元に戻す）ことができる
   * ロールバックではマイグレーションファイルの `down` メソッドが実行される
